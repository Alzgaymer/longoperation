version: 3

tasks:
  terraform:

    desc: Terraform binary
    precondition:
      linting:
        sh: task lint
        msg: Fix linting
    cmd:
      terraform {{.CLI_ARGS}}

  lint:
    desc: Terraform linting
    vars:
      TFLINT_CONFIG: ../.tflint.hcl
      required:
        - TFLINT_CONFIG
    cmd: tflint -c {{.TFLINT_CONFIG}}

