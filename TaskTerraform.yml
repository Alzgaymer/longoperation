version: 3

tasks:
  terraform:
    desc: Terraform binary
    precondition:
      linting:
        sh: task lint
        msg: Fix linting
      formatting:
        sh: task terraform -- fmt
        msg: Format .tf files

    cmd:
      terraform {{.CLI_ARGS}}

  lint:
    desc: Terraform linting
    vars:
      required:
        - TFLINT_CONFIG
    cmd: tflint -c {{.TFLINT_CONFIG}}

